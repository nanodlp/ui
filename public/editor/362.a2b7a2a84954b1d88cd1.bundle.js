"use strict";(self.webpackChunknanosupport=self.webpackChunknanosupport||[]).push([[362],{4362:(e,t,n)=>{n.r(t),n.d(t,{ColladaLoader:()=>r});var s=n(7749),o=n(2792);class r extends s.Loader{constructor(e){super(e)}load(e,t,n,o){const r=this,i=""===r.path?s.LoaderUtils.extractUrlBase(e):r.path,a=new s.FileLoader(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,i))}catch(t){o?o(t):console.error(t),r.manager.itemError(e)}}),n,o)}parse(e,t){function n(e,t){const n=[],s=e.childNodes;for(let e=0,o=s.length;e<o;e++){const o=s[e];o.nodeName===t&&n.push(o)}return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,s=t.length;e<s;e++)n[e]=t[e];return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,s=t.length;e<s;e++)n[e]=parseFloat(t[e]);return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,s=t.length;e<s;e++)n[e]=parseInt(t[e]);return n}function c(e){return e.substring(1)}function l(e){return 0===Object.keys(e).length}function d(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function f(e,t,s,o){const r=n(e,t)[0];if(void 0!==r){const e=n(r,s);for(let t=0;t<e.length;t++)o(e[t])}}function h(e,t){for(const n in e)e[n].build=t(e[n])}function m(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"input"===s.nodeName){const e=c(s.getAttribute("source")),n=s.getAttribute("semantic");t.inputs[n]=e}}return t}function g(e){const t={};let n=e.getAttribute("target").split("/");const s=n.shift();let o=n.shift();const r=-1!==o.indexOf("("),i=-1!==o.indexOf(".");if(i)n=o.split("."),o=n.shift(),t.member=n.shift();else if(r){const e=o.split("(");o=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=s,t.sid=o,t.arraySyntax=r,t.memberSyntax=i,t.sampler=c(e.getAttribute("source")),t}function b(e){const t=[],n=e.channels,s=e.samplers,o=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const r=n[e],i=s[r.sampler],a=i.inputs.INPUT,c=i.inputs.OUTPUT;A(N(r,o[a],o[c]),t)}return t}function y(e){return m(Ye.animations[e],b)}function N(e,t,n){const s=Ye.nodes[e.id],o=Ue(s.id),r=s.transforms[e.sid],i=s.matrix.clone().transpose();let a,c,l,d,u,f;const h={};switch(r){case"matrix":for(l=0,d=t.array.length;l<d;l++)if(a=t.array[l],c=l*n.stride,void 0===h[a]&&(h[a]={}),!0===e.arraySyntax){const t=n.array[c],s=e.indices[0]+4*e.indices[1];h[a][s]=t}else for(u=0,f=n.stride;u<f;u++)h[a][u]=n.array[c+u];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r)}const m=function(e,t){const n=[];for(const t in e)n.push({time:parseFloat(t),value:e[t]});n.sort((function(e,t){return e.time-t.time}));for(let e=0;e<16;e++)v(n,e,t.elements[e]);return n}(h,i);return{name:o.uuid,keyframes:m}}const x=new s.Vector3,k=new s.Vector3,w=new s.Quaternion;function A(e,t){const n=e.keyframes,o=e.name,r=[],i=[],a=[],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=t.time,o=t.value;Ee.fromArray(o).transpose(),Ee.decompose(x,w,k),r.push(s),i.push(x.x,x.y,x.z),a.push(w.x,w.y,w.z,w.w),c.push(k.x,k.y,k.z)}return i.length>0&&t.push(new s.VectorKeyframeTrack(o+".position",r,i)),a.length>0&&t.push(new s.QuaternionKeyframeTrack(o+".quaternion",r,a)),c.length>0&&t.push(new s.VectorKeyframeTrack(o+".scale",r,c)),t}function v(e,t,n){let s,o,r,i=!0;for(o=0,r=e.length;o<r;o++)s=e[o],void 0===s.value[t]?s.value[t]=null:i=!1;if(!0===i)for(o=0,r=e.length;o<r;o++)s=e[o],s.value[t]=n;else!function(e,t){let n,s;for(let o=0,r=e.length;o<r;o++){const r=e[o];if(null===r.value[t]){if(n=T(e,o,t),s=C(e,o,t),null===n){r.value[t]=s.value[t];continue}if(null===s){r.value[t]=n.value[t];continue}E(r,n,s,t)}}}(e,t)}function T(e,t,n){for(;t>=0;){const s=e[t];if(null!==s.value[n])return s;t--}return null}function C(e,t,n){for(;t<e.length;){const s=e[t];if(null!==s.value[n])return s;t++}return null}function E(e,t,n,s){n.time-t.time!=0?e.value[s]=(e.time-t.time)*(n.value[s]-t.value[s])/(n.time-t.time)+t.value[s]:e.value[s]=t.value[s]}function _(e){const t=[],n=e.name,o=e.end-e.start||-1,r=e.animations;for(let e=0,n=r.length;e<n;e++){const n=y(r[e]);for(let e=0,s=n.length;e<s;e++)t.push(n[e])}return new s.AnimationClip(n,o,t)}function R(e){return m(Ye.clips[e],_)}function M(e){const t={sources:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(s.textContent);break;case"source":const e=s.getAttribute("id");t.sources[e]=ae(s);break;case"joints":t.joints=L(s);break;case"vertex_weights":t.vertexWeights=O(s)}}return t}function L(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"input"===s.nodeName){const e=s.getAttribute("semantic"),n=c(s.getAttribute("source"));t.inputs[e]=n}}return t}function O(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=s.getAttribute("semantic"),n=c(s.getAttribute("source")),o=parseInt(s.getAttribute("offset"));t.inputs[e]={id:n,offset:o};break;case"vcount":t.vcount=a(s.textContent);break;case"v":t.v=a(s.textContent)}}return t}function I(e){const t={id:e.id},n=Ye.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=e.sources,o=e.vertexWeights,r=o.vcount,i=o.v,a=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,l=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],u=n[o.inputs.WEIGHT.id].array;let f,h,m,p=0;for(f=0,m=r.length;f<m;f++){const e=r[f],n=[];for(h=0;h<e;h++){const e=i[p+a],t=u[i[p+c]];n.push({index:e,weight:t}),p+=2}for(n.sort(g),h=0;h<4;h++){const e=n[h];void 0!==e?(t.indices.array.push(e.index),t.weights.array.push(e.weight)):(t.indices.array.push(0),t.weights.array.push(0))}}for(e.bindShapeMatrix?t.bindMatrix=(new s.Matrix4).fromArray(e.bindShapeMatrix).transpose():t.bindMatrix=(new s.Matrix4).identity(),f=0,m=l.array.length;f<m;f++){const e=l.array[f],n=(new s.Matrix4).fromArray(d.array,f*d.stride).transpose();t.joints.push({name:e,boneInverse:n})}return t;function g(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function j(e){return void 0!==e.build?e.build:e.init_from}function q(e){const t=Ye.images[e];return void 0!==t?m(t,j):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function S(e){const t={surfaces:{},samplers:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"newparam":B(s,t);break;case"technique":t.technique=H(s);break;case"extra":t.extra=z(s)}}return t}function B(e,t){const n=e.getAttribute("sid");for(let s=0,o=e.childNodes.length;s<o;s++){const o=e.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[n]=U(o);break;case"sampler2D":t.samplers[n]=F(o)}}}function U(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"init_from"===s.nodeName&&(t.init_from=s.textContent)}return t}function F(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"source"===s.nodeName&&(t.source=s.textContent)}return t}function H(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=s.nodeName,t.parameters=V(s);break;case"extra":t.extra=z(s)}}return t}function V(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[s.nodeName]=P(s);break;case"transparent":t[s.nodeName]={opaque:s.hasAttribute("opaque")?s.getAttribute("opaque"):"A_ONE",data:P(s)}}}return t}function P(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"color":t[s.nodeName]=i(s.textContent);break;case"float":t[s.nodeName]=parseFloat(s.textContent);break;case"texture":t[s.nodeName]={id:s.getAttribute("texture"),extra:G(s)}}}return t}function G(e){const t={technique:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"extra"===s.nodeName&&D(s,t)}return t}function D(e,t){for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"technique"===s.nodeName&&W(s,t)}}function W(e,t){for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[s.nodeName]=parseFloat(s.textContent);break;case"wrapU":case"wrapV":"TRUE"===s.textContent.toUpperCase()?t.technique[s.nodeName]=1:"FALSE"===s.textContent.toUpperCase()?t.technique[s.nodeName]=0:t.technique[s.nodeName]=parseInt(s.textContent);break;case"bump":t[s.nodeName]=X(s)}}}function z(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"technique"===s.nodeName&&(t.technique=J(s))}return t}function J(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"double_sided":t[s.nodeName]=parseInt(s.textContent);break;case"bump":t[s.nodeName]=X(s)}}return t}function X(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"texture"===s.nodeName&&(t[s.nodeName]={id:s.getAttribute("texture"),texcoord:s.getAttribute("texcoord"),extra:G(s)})}return t}function K(e){return e}function Z(e){const t=(n=e.url,m(Ye.effects[n],K));var n;const o=t.profile.technique;let r;switch(o.type){case"phong":case"blinn":r=new s.MeshPhongMaterial;break;case"lambert":r=new s.MeshLambertMaterial;break;default:r=new s.MeshBasicMaterial}function i(e,n=null){const o=t.profile.samplers[e.id];let r=null;if(void 0!==o?r=q(t.profile.surfaces[o.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=q(e.id)),null!==r){const t=function(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));return n=n.toLowerCase(),t="tga"===n?Je:ze,t}(r);if(void 0!==t){const o=t.load(r),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===l(i.technique)){const e=i.technique;o.wrapS=e.wrapU?s.RepeatWrapping:s.ClampToEdgeWrapping,o.wrapT=e.wrapV?s.RepeatWrapping:s.ClampToEdgeWrapping,o.offset.set(e.offsetU||0,e.offsetV||0),o.repeat.set(e.repeatU||1,e.repeatV||1)}else o.wrapS=s.RepeatWrapping,o.wrapT=s.RepeatWrapping;return null!==n&&(o.encoding=n),o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";const a=o.parameters;for(const e in a){const t=a[e];switch(e){case"diffuse":t.color&&r.color.fromArray(t.color),t.texture&&(r.map=i(t.texture,s.sRGBEncoding));break;case"specular":t.color&&r.specular&&r.specular.fromArray(t.color),t.texture&&(r.specularMap=i(t.texture));break;case"bump":t.texture&&(r.normalMap=i(t.texture));break;case"ambient":t.texture&&(r.lightMap=i(t.texture,s.sRGBEncoding));break;case"shininess":t.float&&r.shininess&&(r.shininess=t.float);break;case"emission":t.color&&r.emissive&&r.emissive.fromArray(t.color),t.texture&&(r.emissiveMap=i(t.texture,s.sRGBEncoding))}}r.color.convertSRGBToLinear(),r.specular&&r.specular.convertSRGBToLinear(),r.emissive&&r.emissive.convertSRGBToLinear();let c=a.transparent,d=a.transparency;if(void 0===d&&c&&(d={float:1}),void 0===c&&d&&(c={opaque:"A_ONE",data:{color:[1,1,1,1]}}),c&&d)if(c.data.texture)r.transparent=!0;else{const e=c.data.color;switch(c.opaque){case"A_ONE":r.opacity=e[3]*d.float;break;case"RGB_ZERO":r.opacity=1-e[0]*d.float;break;case"A_ZERO":r.opacity=1-e[3]*d.float;break;case"RGB_ONE":r.opacity=e[0]*d.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',c.opaque)}r.opacity<1&&(r.transparent=!0)}if(void 0!==o.extra&&void 0!==o.extra.technique){const e=o.extra.technique;for(const t in e){const n=e[t];switch(t){case"double_sided":r.side=1===n?s.DoubleSide:s.FrontSide;break;case"bump":r.normalMap=i(n.texture),r.normalScale=new s.Vector2(1,1)}}}return r}function Q(e){return m(Ye.materials[e],Z)}function Y(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return $(n)}return{}}function $(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"perspective":case"orthographic":t.technique=s.nodeName,t.parameters=ee(s)}}return t}function ee(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[s.nodeName]=parseFloat(s.textContent)}}return t}function te(e){let t;switch(e.optics.technique){case"perspective":t=new s.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,o=e.optics.parameters.xmag;const r=e.optics.parameters.aspect_ratio;o=void 0===o?n*r:o,n=void 0===n?o/r:n,o*=.5,n*=.5,t=new s.OrthographicCamera(-o,o,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new s.PerspectiveCamera}return t.name=e.name||"",t}function ne(e){const t=Ye.cameras[e];return void 0!==t?m(t,te):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function se(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=s.nodeName,t.parameters=oe(s)}}return t}function oe(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":const e=i(o.textContent);t.color=(new s.Color).fromArray(e).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":const n=parseFloat(o.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function re(e){let t;switch(e.technique){case"directional":t=new s.DirectionalLight;break;case"point":t=new s.PointLight;break;case"spot":t=new s.SpotLight;break;case"ambient":t=new s.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ie(e){const t=Ye.lights[e];return void 0!==t?m(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){const t={array:[],stride:3};for(let s=0;s<e.childNodes.length;s++){const o=e.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=r(o.textContent);break;case"technique_common":const e=n(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function ce(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&(t[s.getAttribute("semantic")]=c(s.getAttribute("source")))}return t}function le(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=c(s.getAttribute("source")),n=s.getAttribute("semantic"),o=parseInt(s.getAttribute("offset")),r=parseInt(s.getAttribute("set")),i=r>0?n+r:n;t.inputs[i]={id:e,offset:o},t.stride=Math.max(t.stride,o+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=a(s.textContent);break;case"p":t.p=a(s.textContent)}}return t}function de(e){let t=0;for(let n=0,s=e.length;n<s;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ue(e){const t={},n=e.sources,s=e.vertices,o=e.primitives;if(0===o.length)return{};const r=function(e){const t={};for(let n=0;n<e.length;n++){const s=e[n];void 0===t[s.type]&&(t[s.type]=[]),t[s.type].push(s)}return t}(o);for(const e in r){const o=r[e];de(o),t[e]=fe(o,n,s)}return t}function fe(e,t,n){const o={},r={array:[],stride:0},i={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},d=[],u=[],f=new s.BufferGeometry,h=[];let m=0;for(let s=0;s<e.length;s++){const o=e[s],p=o.inputs;let g=0;switch(o.type){case"lines":case"linestrips":g=2*o.count;break;case"triangles":g=3*o.count;break;case"polylist":for(let e=0;e<o.count;e++){const t=o.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",o.type)}f.addGroup(m,g,s),m+=g,o.material&&h.push(o.material);for(const s in p){const f=p[s];switch(s){case"VERTEX":for(const s in n){const h=n[s];switch(s){case"POSITION":const n=r.array.length;if(he(o,t[h],f.offset,r.array),r.stride=t[h].stride,t.skinWeights&&t.skinIndices&&(he(o,t.skinIndices,f.offset,d),he(o,t.skinWeights,f.offset,u)),!1===o.hasUV&&!0===e.uvsNeedsFix){const e=(r.array.length-n)/r.stride;for(let t=0;t<e;t++)a.array.push(0,0)}break;case"NORMAL":he(o,t[h],f.offset,i.array),i.stride=t[h].stride;break;case"COLOR":he(o,t[h],f.offset,l.array),l.stride=t[h].stride;break;case"TEXCOORD":he(o,t[h],f.offset,a.array),a.stride=t[h].stride;break;case"TEXCOORD1":he(o,t[h],f.offset,c.array),a.stride=t[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',s)}}break;case"NORMAL":he(o,t[f.id],f.offset,i.array),i.stride=t[f.id].stride;break;case"COLOR":he(o,t[f.id],f.offset,l.array,!0),l.stride=t[f.id].stride;break;case"TEXCOORD":he(o,t[f.id],f.offset,a.array),a.stride=t[f.id].stride;break;case"TEXCOORD1":he(o,t[f.id],f.offset,c.array),c.stride=t[f.id].stride}}}return r.array.length>0&&f.setAttribute("position",new s.Float32BufferAttribute(r.array,r.stride)),i.array.length>0&&f.setAttribute("normal",new s.Float32BufferAttribute(i.array,i.stride)),l.array.length>0&&f.setAttribute("color",new s.Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&f.setAttribute("uv",new s.Float32BufferAttribute(a.array,a.stride)),c.array.length>0&&f.setAttribute("uv2",new s.Float32BufferAttribute(c.array,c.stride)),d.length>0&&f.setAttribute("skinIndex",new s.Float32BufferAttribute(d,4)),u.length>0&&f.setAttribute("skinWeight",new s.Float32BufferAttribute(u,4)),o.data=f,o.type=e[0].type,o.materialKeys=h,o}function he(e,t,n,s,o=!1){const r=e.p,i=e.stride,a=e.vcount;function c(e){let t=r[e+n]*d;const i=t+d;for(;t<i;t++)s.push(l[t]);if(o){const e=s.length-d-1;Xe.setRGB(s[e+0],s[e+1],s[e+2]).convertSRGBToLinear(),s[e+0]=Xe.r,s[e+1]=Xe.g,s[e+2]=Xe.b}}const l=t.array,d=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=a.length;t<n;t++){const n=a[t];if(4===n){const t=e+1*i,n=e+2*i,s=e+3*i;c(e+0*i),c(t),c(s),c(t),c(n),c(s)}else if(3===n){const t=e+1*i,n=e+2*i;c(e+0*i),c(t),c(n)}else if(n>4)for(let t=1,s=n-2;t<=s;t++){const n=e+i*t,s=e+i*(t+1);c(e+0*i),c(n),c(s)}e+=i*n}}else for(let e=0,t=r.length;e<t;e+=i)c(e)}function me(e){return m(Ye.geometries[e],ue)}function pe(e){return void 0!==e.build?e.build:e}function ge(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"joint":t.joints[s.getAttribute("sid")]=be(s);break;case"link":t.links.push(Ne(s))}}}function be(e){let t;for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"prismatic":case"revolute":t=ye(s)}}return t}function ye(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new s.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"axis":const e=i(s.textContent);t.axis.fromArray(e);break;case"limits":const n=s.getElementsByTagName("max")[0],o=s.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(o.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function Ne(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"attachment_full":t.attachments.push(xe(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(ke(s))}}return t}function xe(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"link":t.links.push(Ne(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(ke(s))}}return t}function ke(e){const t={type:e.nodeName},n=i(e.textContent);switch(t.type){case"matrix":t.obj=new s.Matrix4,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new s.Vector3,t.obj.fromArray(n);break;case"rotate":t.obj=new s.Vector3,t.obj.fromArray(n),t.angle=s.MathUtils.degToRad(n[3])}return t}function we(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&"technique_common"===s.nodeName&&Ae(s,t)}}function Ae(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"inertia":t.inertia=i(s.textContent);break;case"mass":t.mass=i(s.textContent)[0]}}}function ve(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType&&"axis"===s.nodeName){const e=s.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substring(0,n.length-1)}}return t}function Te(e){return void 0!==e.build?e.build:e}function Ce(e){const t=[],n=Pe.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){const o=n.childNodes[e];if(1!==o.nodeType)continue;let r,a;switch(o.nodeName){case"matrix":r=i(o.textContent);const e=(new s.Matrix4).fromArray(r).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:e});break;case"translate":case"scale":r=i(o.textContent),a=(new s.Vector3).fromArray(r),t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"rotate":r=i(o.textContent),a=(new s.Vector3).fromArray(r);const n=s.MathUtils.degToRad(r[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a,angle:n})}}return t}const Ee=new s.Matrix4,_e=new s.Vector3;function Re(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new s.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1!==o.nodeType)continue;let r;switch(o.nodeName){case"node":t.nodes.push(o.getAttribute("id")),Re(o);break;case"instance_camera":t.instanceCameras.push(c(o.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Me(o));break;case"instance_light":t.instanceLights.push(c(o.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Me(o));break;case"instance_node":t.instanceNodes.push(c(o.getAttribute("url")));break;case"matrix":r=i(o.textContent),t.matrix.multiply(Ee.fromArray(r).transpose()),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"translate":r=i(o.textContent),_e.fromArray(r),t.matrix.multiply(Ee.makeTranslation(_e.x,_e.y,_e.z)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"rotate":r=i(o.textContent);const e=s.MathUtils.degToRad(r[3]);t.matrix.multiply(Ee.makeRotationAxis(_e.fromArray(r),e)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"scale":r=i(o.textContent),t.matrix.scale(_e.fromArray(r)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"extra":break;default:console.log(o)}}return Be(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ye.nodes[t.id]=t,t}function Me(e){const t={id:c(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"bind_material":const e=s.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const s=e[n],o=s.getAttribute("symbol"),r=s.getAttribute("target");t.materials[o]=c(r)}break;case"skeleton":t.skeletons.push(c(s.textContent))}}return t}function Le(e,t){const n=[],o=[];let r,i,a;for(r=0;r<e.length;r++){const s=e[r];let o;if(Be(s))o=Ue(s),Oe(o,t,n);else if(c=s,void 0!==Ye.visualScenes[c]){const e=Ye.visualScenes[s].children;for(let s=0;s<e.length;s++){const o=e[s];"JOINT"===o.type&&Oe(Ue(o.id),t,n)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}var c;for(r=0;r<t.length;r++)for(i=0;i<n.length;i++)if(a=n[i],a.bone.name===t[r].name){o[r]=a,a.processed=!0;break}for(r=0;r<n.length;r++)a=n[r],!1===a.processed&&(o.push(a),a.processed=!0);const l=[],d=[];for(r=0;r<o.length;r++)a=o[r],l.push(a.bone),d.push(a.boneInverse);return new s.Skeleton(l,d)}function Oe(e,t,n){e.traverse((function(e){if(!0===e.isBone){let o;for(let n=0;n<t.length;n++){const s=t[n];if(s.name===e.name){o=s.boneInverse;break}}void 0===o&&(o=new s.Matrix4),n.push({bone:e,boneInverse:o,processed:!1})}}))}function Ie(e){const t=[],n=e.matrix,o=e.nodes,r=e.type,i=e.instanceCameras,a=e.instanceControllers,c=e.instanceLights,l=e.instanceGeometries,d=e.instanceNodes;for(let e=0,n=o.length;e<n;e++)t.push(Ue(o[e]));for(let e=0,n=i.length;e<n;e++){const n=ne(i[e]);null!==n&&t.push(n.clone())}for(let e=0,n=a.length;e<n;e++){const n=a[e],s=(u=n.id,m(Ye.controllers[u],I)),o=Se(me(s.id),n.materials),r=Le(n.skeletons,s.skin.joints);for(let e=0,n=o.length;e<n;e++){const n=o[e];n.isSkinnedMesh&&(n.bind(r,s.skin.bindMatrix),n.normalizeSkinWeights()),t.push(n)}}var u;for(let e=0,n=c.length;e<n;e++){const n=ie(c[e]);null!==n&&t.push(n.clone())}for(let e=0,n=l.length;e<n;e++){const n=l[e],s=Se(me(n.id),n.materials);for(let e=0,n=s.length;e<n;e++)t.push(s[e])}for(let e=0,n=d.length;e<n;e++)t.push(Ue(d[e]).clone());let f;if(0===o.length&&1===t.length)f=t[0];else{f="JOINT"===r?new s.Bone:new s.Group;for(let e=0;e<t.length;e++)f.add(t[e])}return f.name="JOINT"===r?e.sid:e.name,f.matrix.copy(n),f.matrix.decompose(f.position,f.quaternion,f.scale),f}const je=new s.MeshBasicMaterial({color:16711935});function qe(e,t){const n=[];for(let s=0,o=e.length;s<o;s++){const o=t[e[s]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[s]),n.push(je)):n.push(Q(o))}return n}function Se(e,t){const n=[];for(const o in e){const r=e[o],i=qe(r.materialKeys,t);0===i.length&&("lines"===o||"linestrips"===o?i.push(new s.LineBasicMaterial):i.push(new s.MeshPhongMaterial));const a=void 0!==r.data.attributes.skinIndex,c=1===i.length?i[0]:i;let l;switch(o){case"lines":l=new s.LineSegments(r.data,c);break;case"linestrips":l=new s.Line(r.data,c);break;case"triangles":case"polylist":l=a?new s.SkinnedMesh(r.data,c):new s.Mesh(r.data,c)}n.push(l)}return n}function Be(e){return void 0!==Ye.nodes[e]}function Ue(e){return m(Ye.nodes[e],Ie)}function Fe(e){const t=new s.Group;t.name=e.name;const n=e.children;for(let e=0;e<n.length;e++){const s=n[e];t.add(Ue(s.id))}return t}function He(e){return m(Ye.visualScenes[e],Fe)}if(0===e.length)return{scene:new s.Scene};const Ve=(new DOMParser).parseFromString(e,"application/xml"),Pe=n(Ve,"COLLADA")[0],Ge=Ve.getElementsByTagName("parsererror")[0];if(void 0!==Ge){const e=n(Ge,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(Ge),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const De=Pe.getAttribute("version");console.log("THREE.ColladaLoader: File version",De);const We=function(e){return{unit:d(n(e,"unit")[0]),upAxis:u(n(e,"up_axis")[0])}}(n(Pe,"asset")[0]),ze=new s.TextureLoader(this.manager);let Je;ze.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),o.U&&(Je=new o.U(this.manager),Je.setPath(this.resourcePath||t));const Xe=new s.Color,Ke=[];let Ze={},Qe=0;const Ye={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};f(Pe,"library_animations","animation",(function e(t){const n={sources:{},samplers:{},channels:{}};let o=!1;for(let s=0,r=t.childNodes.length;s<r;s++){const r=t.childNodes[s];if(1!==r.nodeType)continue;let i;switch(r.nodeName){case"source":i=r.getAttribute("id"),n.sources[i]=ae(r);break;case"sampler":i=r.getAttribute("id"),n.samplers[i]=p(r);break;case"channel":i=r.getAttribute("target"),n.channels[i]=g(r);break;case"animation":e(r),o=!0;break;default:console.log(r)}}!1===o&&(Ye.animations[t.getAttribute("id")||s.MathUtils.generateUUID()]=n)})),f(Pe,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"instance_animation"===s.nodeName&&t.animations.push(c(s.getAttribute("url")))}Ye.clips[e.getAttribute("id")]=t})),f(Pe,"library_controllers","controller",(function(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"skin":t.id=c(s.getAttribute("source")),t.skin=M(s);break;case"morph":t.id=c(s.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ye.controllers[e.getAttribute("id")]=t})),f(Pe,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Ye.images[e.getAttribute("id")]=t})),f(Pe,"library_effects","effect",(function(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"profile_COMMON"===s.nodeName&&(t.profile=S(s))}Ye.effects[e.getAttribute("id")]=t})),f(Pe,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"instance_effect"===s.nodeName&&(t.url=c(s.getAttribute("url")))}Ye.materials[e.getAttribute("id")]=t})),f(Pe,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"optics"===s.nodeName&&(t.optics=Y(s))}Ye.cameras[e.getAttribute("id")]=t})),f(Pe,"library_lights","light",(function(e){let t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];1===s.nodeType&&"technique_common"===s.nodeName&&(t=se(s))}Ye.lights[e.getAttribute("id")]=t})),f(Pe,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},s=n(e,"mesh")[0];if(void 0!==s){for(let e=0;e<s.childNodes.length;e++){const n=s.childNodes[e];if(1!==n.nodeType)continue;const o=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[o]=ae(n);break;case"vertices":t.vertices=ce(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(le(n));break;default:console.log(n)}}Ye.geometries[e.getAttribute("id")]=t}})),f(Pe,"library_nodes","node",Re),f(Pe,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Qe++)}}(e);const s=n(e,"node");for(let e=0;e<s.length;e++)t.children.push(Re(s[e]));Ye.visualScenes[e.getAttribute("id")]=t})),f(Pe,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&"technique_common"===s.nodeName&&ge(s,t)}Ye.kinematicsModels[e.getAttribute("id")]=t})),f(Pe,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&"rigid_body"===s.nodeName&&(t.rigidBodies[s.getAttribute("name")]={},we(s,t.rigidBodies[s.getAttribute("name")]))}Ye.physicsModels[e.getAttribute("id")]=t})),f(Pe,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&"bind_joint_axis"===s.nodeName&&t.bindJointAxis.push(ve(s))}Ye.kinematicsScenes[c(e.getAttribute("url"))]=t})),h(Ye.animations,b),h(Ye.clips,_),h(Ye.controllers,I),h(Ye.images,j),h(Ye.effects,K),h(Ye.materials,Z),h(Ye.cameras,te),h(Ye.lights,re),h(Ye.geometries,ue),h(Ye.visualScenes,Fe),function(){const e=Ye.clips;if(!0===l(e)){if(!1===l(Ye.animations)){const e=[];for(const t in Ye.animations){const n=y(t);for(let t=0,s=n.length;t<s;t++)e.push(n[t])}Ke.push(new s.AnimationClip("default",-1,e))}}else for(const t in e)Ke.push(R(t))}(),function(){const e=Object.keys(Ye.kinematicsModels)[0],t=Object.keys(Ye.kinematicsScenes)[0],n=Object.keys(Ye.visualScenes)[0];if(void 0===e||void 0===t)return;const o=(r=e,m(Ye.kinematicsModels[r],pe));var r;const i=function(e){return m(Ye.kinematicsScenes[e],Te)}(t),a=He(n),c=i.bindJointAxis,l={};for(let e=0,t=c.length;e<t;e++){const t=c[e],n=Pe.querySelector('[sid="'+t.target+'"]');if(n){const e=n.parentElement;d(t.jointIndex,e)}}function d(e,t){const n=t.getAttribute("name"),s=o.joints[e];a.traverse((function(o){o.name===n&&(l[e]={object:o,transforms:Ce(t),joint:s,position:s.zeroPosition})}))}const u=new s.Matrix4;Ze={joints:o&&o.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=l[e];if(n){const o=n.joint;if(t>o.limits.max||t<o.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+").");else if(o.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const r=n.object,i=o.axis,a=n.transforms;Ee.identity();for(let n=0;n<a.length;n++){const r=a[n];if(r.sid&&-1!==r.sid.indexOf(e))switch(o.type){case"revolute":Ee.multiply(u.makeRotationAxis(i,s.MathUtils.degToRad(t)));break;case"prismatic":Ee.multiply(u.makeTranslation(i.x*t,i.y*t,i.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+o.type)}else switch(r.type){case"matrix":Ee.multiply(r.obj);break;case"translate":Ee.multiply(u.makeTranslation(r.obj.x,r.obj.y,r.obj.z));break;case"scale":Ee.scale(r.obj);break;case"rotate":Ee.multiply(u.makeRotationAxis(r.obj,r.angle))}}r.matrix.copy(Ee),r.matrix.decompose(r.position,r.quaternion,r.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const $e=function(e){return He(c(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Pe,"scene")[0]);return $e.animations=Ke,"Z_UP"===We.upAxis&&$e.quaternion.setFromEuler(new s.Euler(-Math.PI/2,0,0)),$e.scale.multiplyScalar(We.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ke},kinematics:Ze,library:Ye,scene:$e}}}}}]);